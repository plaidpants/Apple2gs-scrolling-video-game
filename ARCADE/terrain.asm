         case  on         copy  globals.asm;********************; Terrain Segment;********************InitTerrain startSrcTerrainShapesPtr1  equ 0SrcTerrainShapesPtr2  equ 4DestTerrainShapesPtr1 equ 8DestTerrainShapesPtr2 equ 12         phd         lda   |MyZeroPage         tcd         lda   |Shapes         sta   <SrcTerrainShapesPtr1         lda   |(Shapes+2)         sta   <(SrcTerrainShapesPtr1+2)         lda   |Shapes         clc         adc   #$0010         sta   <SrcTerrainShapesPtr2         lda   |(Shapes+2)         adc   #$0000         sta   <(SrcTerrainShapesPtr2+2)         lda   #$0000         sta   <DestTerrainShapesPtr1         sta   <DestTerrainShapesPtr2         lda   |(TerrainShapes1+2)         sta   <(DestTerrainShapesPtr1+2)         lda   |(TerrainShapes2+2)         sta   <(DestTerrainShapesPtr2+2)loop1    ldy   #0loop2    lda   [<SrcTerrainShapesPtr1],y         sta   [<DestTerrainShapesPtr1],y         lda   [<SrcTerrainShapesPtr2],y         sta   [<DestTerrainShapesPtr2],y         iny         iny         cpy   #$0010         bne   loop2         lda   <SrcTerrainShapesPtr1         clc         adc   #$0020         sta   <SrcTerrainShapesPtr1         lda   <(SrcTerrainShapesPtr1+2)         adc   #$0000         sta   <(SrcTerrainShapesPtr1+2)         lda   <SrcTerrainShapesPtr2         clc         adc   #$0020         sta   <SrcTerrainShapesPtr2         lda   <(SrcTerrainShapesPtr2+2)         adc   #$0000         sta   <(SrcTerrainShapesPtr2+2)         lda   <DestTerrainShapesPtr1         clc         adc   #$0010         sta   <DestTerrainShapesPtr1         lda   <DestTerrainShapesPtr2         clc         adc   #$0010         sta   <DestTerrainShapesPtr2         lda   <DestTerrainShapesPtr2         cmp   #$0000         bne   loop1         pld         rtl         endUpdateTerrain startSrcTerrainX equ 0SrcTerrainY equ 2TempTerrainX equ    4TempTerrainY equ    6TempTerrainGridPtr equ 8TempTerrainShapesPtr equ 10TerrainGridPtr equ 12TerrainShapesPtr1 equ 16TerrainShapesPtr2 equ 20         phd         phb         lda   |MyZeroPage         tcd         lda   |TerrainX         sta   <SrcTerrainX         lda   |TerrainY         sta   <SrcTerrainY         lda   |TerrainGrid+2         sta   <TerrainGridPtr+2         lda   |TerrainShapes1+2         sta   <TerrainShapesPtr1+2         lda   |TerrainShapes2+2         sta   <TerrainShapesPtr2+2         lda   #$0101         pha         plb         plb         lda   <SrcTerrainY         and   #$FFE0         sta   <TempTerrainY         ldx   #PlayfieldX+PlayfieldY*ScreenWidthloop1    lda   <SrcTerrainX         and   #$FFE0         sta   <TempTerrainX         lda   <TempTerrainY         tay         and   #$FF00         sta   <TempTerrainGridPtr         tya         and   #$00F0         sta   <TempTerrainShapesPtr         ldy   #0loop2    lda   <TempTerrainX         and   #$FF00         xba         ora   <TempTerrainGridPtr         sta   <TerrainGridPtr         lda   [<TerrainGridPtr]         and   #$00FF         xba         ora   <TempTerrainShapesPtr         sta   <TerrainShapesPtr1         lda   <TempTerrainX         and   #$00E0         lsr   a         lsr   a         lsr   a         lsr   a         ora   <TerrainShapesPtr1         sta   <TerrainShapesPtr1         sta   <TerrainShapesPtr2         lda   [<TerrainShapesPtr1]         sta   |$2000,x         lda   [<TerrainShapesPtr2]         sta   |$20A0,x         lda   <TempTerrainX         clc         adc   #$0020         sta   <TempTerrainX         inx         inx         iny         cpy   #PlayfieldWidth/2         bne   loop2         lda   <TempTerrainY         clc         adc   #$0010         sta   <TempTerrainY         txa         clc         adc   #ScreenWidth*2-PlayfieldWidth         tax         cpx   #PlayfieldX+(PlayfieldY+PlayfieldHeight)*ScreenWidth         bne   loop1         plb         pld         rtl         endUpdateTerrainLeft startSrcTerrainX          equ 0SrcTerrainY          equ 2TempTerrainX         equ 4TempTerrainY         equ 6TempTerrainGridPtr   equ 8TempTerrainShapesPtr equ 10TerrainGridPtr       equ 12TerrainShapesPtr1    equ 16TerrainShapesPtr2    equ 20         phd         phb         lda   |MyZeroPage         tcd         lda   |TerrainX         sta   <SrcTerrainX         lda   |TerrainY         sta   <SrcTerrainY         lda   |TerrainGrid+2         sta   <TerrainGridPtr+2         lda   |TerrainShapes1+2         sta   <TerrainShapesPtr1+2         lda   |TerrainShapes2+2         sta   <TerrainShapesPtr2+2         lda   #$0101         pha         plb         plb         lda   <SrcTerrainY         and   #$FFE0         sta   <TempTerrainY         ldx   #PlayfieldX+PlayfieldY*ScreenWidth         lda   <SrcTerrainX         and   #$FFE0         sta   <TempTerrainXloop     lda   <TempTerrainY         tay         and   #$FF00         sta   <TempTerrainGridPtr         tya         and   #$00F0         sta   <TempTerrainShapesPtr         lda   <TempTerrainX         and   #$FF00         xba         ora   <TempTerrainGridPtr         sta   <TerrainGridPtr         lda   [<TerrainGridPtr]         and   #$00FF         xba         ora   <TempTerrainShapesPtr         sta   <TerrainShapesPtr1         lda   <TempTerrainX         and   #$00E0         lsr   a         lsr   a         lsr   a         lsr   a         ora   <TerrainShapesPtr1         sta   <TerrainShapesPtr1         sta   <TerrainShapesPtr2         lda   [<TerrainShapesPtr1]         sta   |$2000,x         lda   [<TerrainShapesPtr2]         sta   |$20A0,x         lda   <TempTerrainY         clc         adc   #$0010         sta   <TempTerrainY         txa         clc         adc   #ScreenWidth*2         tax         cpx   #PlayfieldX+(PlayfieldY+PlayfieldHeight)*ScreenWidth         bne   loop         plb         pld         rtl         endUpdateTerrainRight startSrcTerrainX equ 0SrcTerrainY equ 2TempTerrainX equ    4TempTerrainY equ    6TempTerrainGridPtr equ 8TempTerrainShapesPtr equ 10TerrainGridPtr equ 12TerrainShapesPtr1 equ 16TerrainShapesPtr2 equ 20         phd         phb         lda   |MyZeroPage         tcd         lda   |TerrainX         clc         adc   #(PlayfieldWidth-2)*$0010         sta   <SrcTerrainX         lda   |TerrainY         sta   <SrcTerrainY         lda   |TerrainGrid+2         sta   <TerrainGridPtr+2         lda   |TerrainShapes1+2         sta   <TerrainShapesPtr1+2         lda   |TerrainShapes2+2         sta   <TerrainShapesPtr2+2         lda   #$0101         pha         plb         plb         lda   <SrcTerrainY         and   #$FFE0         sta   <TempTerrainY         ldx   #PlayfieldX+PlayfieldY*ScreenWidth+PlayfieldWidth-2loop     lda   <SrcTerrainX         and   #$FFE0         sta   <TempTerrainX         lda   <TempTerrainY         tay         and   #$FF00         sta   <TempTerrainGridPtr         tya         and   #$00F0         sta   <TempTerrainShapesPtr         lda   <TempTerrainX         and   #$FF00         xba         ora   <TempTerrainGridPtr         sta   <TerrainGridPtr         lda   [<TerrainGridPtr]         and   #$00FF         xba         ora   <TempTerrainShapesPtr         sta   <TerrainShapesPtr1         lda   <TempTerrainX         and   #$00E0         lsr   a         lsr   a         lsr   a         lsr   a         ora   <TerrainShapesPtr1         sta   <TerrainShapesPtr1         sta   <TerrainShapesPtr2         lda   [<TerrainShapesPtr1]         sta   |$2000,x         lda   [<TerrainShapesPtr2]         sta   |$20A0,x         lda   <TempTerrainY         clc         adc   #$0010         sta   <TempTerrainY         txa         clc         adc   #ScreenWidth*2         tax         cpx   #PlayfieldX+(PlayfieldY+PlayfieldHeight)*ScreenWidth+PlayfieldWidth-2         bne   loop         plb         pld         rtl         endUpdateTerrainTop startSrcTerrainX equ 0SrcTerrainY equ 2TempTerrainX equ    4TempTerrainY equ    6TempTerrainGridPtr equ 8TempTerrainShapesPtr equ 10TerrainGridPtr equ 12TerrainShapesPtr1 equ 16TerrainShapesPtr2 equ 20         phd         phb         lda   |MyZeroPage         tcd         lda   |TerrainX         sta   <SrcTerrainX         lda   |TerrainY         sta   <SrcTerrainY         lda   |TerrainGrid+2         sta   <TerrainGridPtr+2         lda   |TerrainShapes1+2         sta   <TerrainShapesPtr1+2         lda   |TerrainShapes2+2         sta   <TerrainShapesPtr2+2         lda   #$0101         pha         plb         plb         lda   <SrcTerrainY         and   #$FFE0         sta   <TempTerrainY         ldx   #PlayfieldX+PlayfieldY*ScreenWidthloop1    lda   <SrcTerrainX         and   #$FFE0         sta   <TempTerrainX         lda   <TempTerrainY         tay         and   #$FF00         sta   <TempTerrainGridPtr         tya         and   #$00F0         sta   <TempTerrainShapesPtr         ldy   #0loop2    lda   <TempTerrainX         and   #$FF00         xba         ora   <TempTerrainGridPtr         sta   <TerrainGridPtr         lda   [<TerrainGridPtr]         and   #$00FF         xba         ora   <TempTerrainShapesPtr         sta   <TerrainShapesPtr1         lda   <TempTerrainX         and   #$00E0         lsr   a         lsr   a         lsr   a         lsr   a         ora   <TerrainShapesPtr1         sta   <TerrainShapesPtr1         sta   <TerrainShapesPtr2         lda   [<TerrainShapesPtr1]         sta   |$2000,x         lda   [<TerrainShapesPtr2]         sta   |$20A0,x         lda   <TempTerrainX         clc         adc   #$0020         sta   <TempTerrainX         inx         inx         iny         cpy   #PlayfieldWidth/2         bne   loop2         lda   <TempTerrainY         clc         adc   #$0010         sta   <TempTerrainY         txa         clc         adc   #ScreenWidth*2-PlayfieldWidth         tax         cpx   #PlayfieldX+(PlayfieldY+4)*ScreenWidth         bne   loop1         plb         pld         rtl         endUpdateTerrainBottom startSrcTerrainX equ 0SrcTerrainY equ 2TempTerrainX equ    4TempTerrainY equ    6TempTerrainGridPtr equ 8TempTerrainShapesPtr equ 10TerrainGridPtr equ 12TerrainShapesPtr1 equ 16TerrainShapesPtr2 equ 20         phd         phb         lda   |MyZeroPage         tcd         lda   |TerrainX         sta   <SrcTerrainX         lda   |TerrainY         clc         adc   #(PlayfieldHeight/2)*$0010-2         sta   <SrcTerrainY         lda   |TerrainGrid+2         sta   <TerrainGridPtr+2         lda   |TerrainShapes1+2         sta   <TerrainShapesPtr1+2         lda   |TerrainShapes2+2         sta   <TerrainShapesPtr2+2         lda   #$0101         pha         plb         plb         lda   <SrcTerrainY         and   #$FFE0         sta   <TempTerrainY         ldx   #PlayfieldX+(PlayfieldY+PlayfieldHeight-4)*ScreenWidthloop1    lda   <SrcTerrainX         and   #$FFE0         sta   <TempTerrainX         lda   <TempTerrainY         tay         and   #$FF00         sta   <TempTerrainGridPtr         tya         and   #$00F0         sta   <TempTerrainShapesPtr         ldy   #0loop2    lda   <TempTerrainX         and   #$FF00         xba         ora   <TempTerrainGridPtr         sta   <TerrainGridPtr         lda   [<TerrainGridPtr]         and   #$00FF         xba         ora   <TempTerrainShapesPtr         sta   <TerrainShapesPtr1         lda   <TempTerrainX         and   #$00E0         lsr   a         lsr   a         lsr   a         lsr   a         ora   <TerrainShapesPtr1         sta   <TerrainShapesPtr1         sta   <TerrainShapesPtr2         lda   [<TerrainShapesPtr1]         sta   |$2000,x         lda   [<TerrainShapesPtr2]         sta   |$20A0,x         lda   <TempTerrainX         clc         adc   #$0020         sta   <TempTerrainX         inx         inx         iny         cpy   #PlayfieldWidth/2         bne   loop2         lda   <TempTerrainY         clc         adc   #$0010         sta   <TempTerrainY         txa         clc         adc   #ScreenWidth*2-PlayfieldWidth         tax         cpx   #PlayfieldX+(PlayfieldY+PlayfieldHeight)*ScreenWidth         bne   loop1         plb         pld         rtl         end